# Kino_K8s Development

```elixir
# Mix.install([{:kino_k8s, github: "mruoss/kino_k8s"}])
Mix.install([{:kino_k8s, path: "~/src/community/kino_k8s"}])
```

## Section

<!-- livebook:{"attrs":{"opts":{"context":"inf-ppe-aks-sn","insecure_skip_tls_verify":true},"result_variable":"conn","source":"~/.kube/config","source_type":"file"},"chunks":null,"kind":"Elixir.KinoK8s.ConnectionCell","livebook_object":"smart_cell"} -->

```elixir
{:ok, conn} =
  K8s.Conn.from_file("~/.kube/config",
    context: "inf-ppe-aks-sn",
    insecure_skip_tls_verify: true
  )

conn
```

<!-- livebook:{"attrs":{"connection":{"conn_hash":30293911,"variable":"conn"},"connections":[{"conn_hash":30293911,"variable":"conn"}],"gvk":{"api_version":"v1","index":"v1configmaps","kind":"ConfigMap","name":"configmaps","namespaced":true},"namespace":"external-secrets","namespaces":["ambassador","apm-proxy","argocd","azureserviceoperator-system","cert-manager","cnrm-system","db-operator","default","e2e","external-secrets","gatekeeper-system","ingress-nginx","kube-node-lease","kube-public","kube-system","mailpit","mailpit-restricted","michael-playground","oauth2-proxy","oauth2-proxy-rmq-test","pr-8938","rabbitmq-system","rmq-management","stnr-infra","techtalk","test","universal-profiling"],"request_type":"get","request_types":["get","list","watch"],"resource":"kube-root-ca.crt","resources":["kube-root-ca.crt"],"result_type":null,"result_types":{"get":null,"list":["list","stream"],"watch":["stream"]},"result_variable":"result"},"chunks":null,"kind":"Elixir.KinoK8s.GetCell","livebook_object":"smart_cell"} -->

````elixir
{:ok, result} =
  K8s.Client.get("v1", "configmaps",
    name: "kube-root-ca.crt",
    namespace: "external-secrets"
  )
  |> K8s.Client.put_conn(conn)
  |> K8s.Client.run()

Kino.Markdown.new("```yaml
#{Ymlr.document!(result)}
```
")
````

```elixir

```

```elixir
{:ok, sa_token} =
  K8s.Client.get("v1", "secrets", name: "ns-admin-token", namespace: "kino-k8s")
  |> K8s.Client.put_conn(conn)
  |> K8s.Client.run()

{:ok, ca_cert} = K8s.Conn.PKI.cert_from_base64(sa_token["data"]["ca.crt"])

admin_conn =
  struct!(conn,
    ca_cert: ca_cert,
    auth: %K8s.Conn.Auth.Token{token: Base.decode64!(sa_token["data"]["token"])},
    namespace: Base.decode64!(sa_token["data"]["namespace"])
  )
```

```elixir
{:ok, cluster_sa_token} =
  K8s.Client.get("v1", "secrets", name: "cluster-admin-token", namespace: "kino-k8s")
  |> K8s.Client.put_conn(conn)
  |> K8s.Client.run()

{:ok, ca_cert} = K8s.Conn.PKI.cert_from_base64(cluster_sa_token["data"]["ca.crt"])

cluster_admin_conn =
  struct!(conn,
    ca_cert: ca_cert,
    auth: %K8s.Conn.Auth.Token{token: Base.decode64!(cluster_sa_token["data"]["token"])},
    namespace: Base.decode64!(cluster_sa_token["data"]["namespace"])
  )
```

<!-- livebook:{"attrs":{"connect_to":"logs","connect_tos":["exec","logs"],"connection":null,"connections":[],"container":null,"containers":null,"namespace":null,"namespaces":null,"pod":null,"pods":null},"chunks":null,"kind":"Elixir.KinoK8s.TerminalCell","livebook_object":"smart_cell"} -->

```elixir

```

```elixir

```
